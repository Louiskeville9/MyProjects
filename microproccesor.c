#include <stm32f031x6.h>
#include "display.h"
#include <stdio.h>
#include <time.h>
#include <stdlib.h>
#define SCREEN_WIDTH 128
#define SCREEN_HEIGHT 160

struct position
{
	int objectX;
	int objectX2;
	int objectY;
};

void initClock(void);
void initSysTick(void);
void SysTick_Handler(void);
void delay(volatile uint32_t dly);
void setupIO();
int isInside(uint16_t x1, uint16_t y1, uint16_t w, uint16_t h, uint16_t px, uint16_t py);
void enablePullUp(GPIO_TypeDef *Port, uint32_t BitNumber);
void pinMode(GPIO_TypeDef *Port, uint32_t BitNumber, uint32_t Mode);
struct position displayImage(struct position);



volatile uint32_t milliseconds;

//Bit map images
const uint16_t deco1[]=
{
0,0,0,0,4,4,4,4,4,0,0,0,0,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,65415,65415,65415,248,65415,0,0,0,0,0,0,0,65415,65415,65415,65415,65415,8068,0,0,0,0,0,0,65415,65415,65415,4096,4096,0,0,0,0,0,0,0,0,65415,65415,65415,0,0,0,0,0,0,0,0,0,7936,7936,7936,0,0,0,0,0,0,0,0,7936,7936,65535,7936,0,0,0,0,0,0,0,0,7936,7936,65535,7936,7936,7936,7936,0,0,0,0,0,7936,7936,65535,65535,65535,65535,7936,0,0,0,0,0,7936,7936,7936,7936,7936,7936,7936,0,0,0,0,0,7936,7936,7936,7936,0,0,0,0,0,0,0,0,0,7936,65535,7936,0,0,0,0,0,0,0,0,0,7936,65535,7936,0,0,0,0,0,0,0,0,0,7936,65535,7936,0,0,0,0,0,0,0,0,0,7940,7940,7940,7940,0,0,0,
};
const uint16_t deco2[]= 
	{
0,0,0,0,0,4,4,4,4,4,0,0,0,0,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,65415,65415,65415,248,65415,0,0,0,0,0,0,0,65415,65415,65415,65415,65415,8068,0,0,0,0,0,0,65415,65415,65415,4096,4096,0,0,0,0,0,0,0,0,65415,65415,65415,0,0,0,0,0,0,0,0,7936,7936,7936,0,0,0,0,0,0,0,0,7936,7936,65535,7936,0,0,0,0,0,0,0,0,7936,7936,65535,7936,7936,7936,7936,0,0,0,0,0,7936,7936,65535,65535,65535,65535,7936,0,0,0,0,0,7936,7936,7936,7936,7936,7936,7936,0,0,0,0,0,7936,7936,7936,7936,0,0,0,0,0,0,0,0,0,40224,7936,65535,7936,0,0,0,0,0,0,0,40224,40224,7936,65535,7936,0,0,0,0,0,0,65315,40224,40224,7936,65535,40224,0,0,0,0,0,0,0,65315,0,65315,65315,65315,65315,0,0,
	};
const uint16_t deco3[]= 
{
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,4,4,4,4,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,7936,7936,4,4,4,4,4,4,7936,7936,0,0,65535,65535,4,4,4,4,4,4,65535,65535,0,0,7936,7936,4,4,4,4,4,4,7936,7936,0,0,0,0,0,4,4,4,4,0,0,0,0,0,0,0,0,0,24327,24327,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};
const uint16_t dg1[]=
{
	0,0,16142,16142,16142,16142,16142,16142,16142,16142,0,0,0,0,0,16142,16142,16142,16142,16142,16142,0,0,0,0,0,16142,16142,16142,16142,16142,16142,16142,16142,0,0,0,0,16142,16142,16142,1994,1994,16142,16142,16142,0,0,0,0,16142,16142,16142,1994,16142,1994,16142,16142,0,0,0,0,16142,16142,16142,1994,16142,1994,16142,16142,0,0,0,0,16142,16142,16142,1994,16142,1994,16142,16142,0,0,0,0,16142,16142,16142,1994,1994,16142,16142,16142,0,0,0,0,16142,16142,16142,16142,16142,16142,16142,16142,0,0,0,0,16142,16142,16142,1994,1994,1994,16142,16142,0,0,0,0,16142,16142,16142,1994,16142,16142,16142,16142,0,0,0,0,16142,16142,16142,1994,16142,16142,16142,16142,0,0,0,0,16142,16142,16142,1994,16142,1994,16142,16142,0,0,0,0,16142,16142,16142,1994,1994,1994,16142,16142,0,0,0,0,0,16142,16142,16142,16142,16142,16142,0,0,0,0,0,0,16142,16142,16142,16142,16142,16142,0,0,0,
};

const uint16_t carTop[] =
{
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40224,40224,40224,0,40224,0,40224,40224,40224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40224,40224,40224,40224,0,40224,0,40224,40224,40224,40224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40224,40224,40224,40224,0,40224,0,40224,40224,40224,40224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61307,40224,40224,40224,40224,0,40224,0,40224,40224,40224,40224,61307,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61307,40224,40224,40224,40224,0,40224,0,40224,40224,40224,40224,61307,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61307,40224,40224,40224,40224,0,40224,0,40224,40224,40224,40224,61307,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40224,13294,13294,13294,13294,13294,13294,13294,13294,13294,40224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40224,13294,13294,13294,13294,13294,13294,13294,13294,13294,40224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40224,40224,40224,40224,0,40224,0,40224,40224,40224,40224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40224,40224,40224,40224,0,40224,0,40224,40224,40224,40224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40224,40224,40224,40224,0,40224,0,40224,40224,40224,40224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40224,40224,40224,40224,0,40224,0,40224,40224,40224,40224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40224,40224,40224,40224,0,40224,0,40224,40224,40224,40224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40224,40224,40224,40224,0,40224,0,40224,40224,40224,40224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40224,40224,40224,40224,0,40224,0,40224,40224,40224,40224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61307,40224,40224,40224,40224,0,40224,0,40224,40224,40224,40224,61307,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61307,40224,13294,13294,13294,13294,13294,13294,13294,13294,13294,40224,61307,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61307,40224,40224,40224,40224,0,40224,0,40224,40224,40224,40224,61307,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40224,40224,40224,40224,0,40224,0,40224,40224,40224,40224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40224,40224,40224,0,40224,0,40224,40224,40224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};


const uint16_t road[] =
{
	24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,256,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,256,0,0,256,0,0,0,0,0,0,0,0,0,0,0,0,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,32519,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,58112,0,0,0,8192,0,0,0,0,0,0,0,256,0,0,0,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,32519,24327,24327,24327,24327,24327,24327,24327,24327,24327,16135,32519,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,33024,0,0,0,0,0,0,0,0,0,0,0,256,0,0,0,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,58112,0,0,0,0,0,0,0,0,0,0,0,256,0,0,0,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,40455,24327,24327,24327,0,0,0,0,0,0,0,0,0,0,0,0,256,0,0,0,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,32519,24327,24327,24327,24327,24327,57856,0,0,0,33024,0,0,0,24576,0,0,0,57856,0,0,0,16135,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,32519,24327,24327,24327,32519,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,32768,0,0,0,0,0,0,0,0,0,0,0,256,0,0,0,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,32519,24327,24327,24327,24327,24327,24327,24327,24327,
};

const uint16_t tree[] =
{
	0,0,0,40960,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,528,9293,9293,9293,9293,9293,9293,9293,9293,9293,9293,9293,9293,9293,9293,9293,9293,9293,528,0,0,0,0,0,0,264,0,0,0,0,33032,0,9293,9293,9293,17203,17203,17203,17203,17203,17203,17203,17203,17203,17203,17203,17203,9293,9293,9293,9293,0,0,16384,0,0,0,0,0,0,0,0,0,0,9293,17203,17203,17203,9293,9293,9293,9293,17203,17203,9293,9293,17203,17203,9293,17203,17203,17203,9293,0,0,0,0,0,0,0,0,0,0,0,0,0,9293,17203,17203,17203,17203,17203,17203,17203,17203,9293,17203,17203,17203,17203,17203,9293,9293,17203,9293,49152,0,0,0,0,0,0,0,0,0,0,0,0,17203,17203,17203,17203,17203,17203,17203,17203,17203,9293,17203,9293,9293,9293,17203,17203,9293,17203,9293,0,0,0,0,0,0,0,0,0,0,0,0,0,17203,9293,17203,17203,9293,17203,9293,17203,17203,17203,17203,17203,17203,17203,9293,17203,17203,17203,9293,0,0,0,0,0,0,0,0,0,0,0,0,0,9293,17203,9293,17203,17203,17203,9293,17203,17203,9293,17203,17203,17203,17203,17203,17203,17203,9293,9293,0,0,0,0,0,0,0,0,0,0,0,0,0,9293,17203,9293,9293,17203,17203,17203,17203,17203,9293,17203,17203,9293,9293,17203,17203,17203,9293,9293,0,0,0,0,0,0,0,0,0,0,0,0,0,9293,9293,17203,17203,17203,17203,17203,17203,17203,9293,17203,17203,9293,9293,17203,17203,17203,9293,9293,0,0,0,0,0,0,0,0,0,0,0,0,0,9293,9293,17203,17203,17203,17203,17203,17203,17203,17203,17203,17203,17203,9293,17203,17203,17203,17203,17203,0,0,0,0,0,0,0,0,0,0,0,0,0,9293,9293,9293,17203,17203,17203,17203,17203,17203,17203,17203,9293,17203,17203,17203,17203,17203,9293,17203,0,0,0,0,0,0,0,0,0,0,0,0,0,9293,9293,17203,17203,17203,17203,17203,9293,17203,17203,17203,9293,9293,17203,17203,9293,17203,9293,17203,0,0,0,0,0,0,0,0,0,0,0,0,0,9293,9293,17203,9293,17203,9293,17203,17203,9293,9293,9293,9293,17203,9293,17203,17203,17203,17203,17203,0,0,0,0,0,0,0,0,0,0,0,0,0,9293,17203,17203,9293,17203,17203,17203,9293,17203,17203,17203,17203,17203,9293,9293,17203,17203,17203,9293,0,0,0,0,0,0,0,0,0,0,0,0,0,9293,17203,17203,17203,17203,17203,17203,17203,17203,17203,17203,17203,9293,17203,17203,17203,17203,9293,9293,0,0,0,0,0,0,0,0,0,0,0,0,0,49416,9293,9293,9293,9293,9293,9293,9293,9293,9293,9293,9293,9293,9293,9293,9293,9293,49152,0,0,0,0,0,0,0,0,0,0,0,0,0,49152,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};

const uint16_t banana[] =
{
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,40960,0,0,0,0,0,0,528,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,60515,60515,24327,24327,33032,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,61043,61043,24327,24327,528,0,33032,0,0,0,0,49416,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24327,24327,24327,24327,24327,16384,0,0,0,0,0,0,0,0,0,16384,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16912,24327,24327,24327,24327,24327,24327,24327,32768,0,0,0,0,0,0,0,0,0,0,32768,24327,24327,60515,60515,0,0,0,0,0,0,57344,0,0,33032,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,528,0,8192,57856,39174,24327,24327,24327,24327,28539,19819,0,0,0,0,0,0,0,0,0,0,16912,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,0,0,0,0,0,0,0,0,0,0,0,0,33032,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,0,0,32768,0,0,0,0,0,0,0,0,264,0,0,16912,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,57608,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,57344,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,8456,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};

const uint16_t smoke[] = 
{
	65535,0,0,33560,33560,33560,33560,33560,33560,33560,33560,33560,0,0,0,0,0,0,0,33560,33560,33560,33560,33560,33560,33560,33560,33560,33560,65535,65535,65535,0,0,0,33560,33560,33560,33560,33560,33560,0,0,0,0,0,0,0,0,0,0,0,0,33560,33560,33560,0,0,0,0,0,0,33560,65535,0,0,0,0,0,43338,0,0,0,0,0,0,0,0,0,0,0,33560,0,0,0,0,33560,33560,0,0,0,33560,33560,33560,0,0,0,0,0,0,33560,0,33560,33560,0,0,33560,0,0,0,33560,33560,0,0,0,43338,0,0,0,33560,0,0,43338,0,0,0,0,0,0,0,33560,0,33560,33560,33560,33560,33560,33560,0,0,33560,0,0,0,0,0,0,0,0,0,0,0,0,0,33560,33560,33560,33560,33560,33560,0,0,0,0,0,0,33560,33560,33560,0,0,0,0,0,0,0,0,0,0,0,0,33560,33560,0,33560,0,0,0,33560,0,43338,33560,0,0,0,0,33560,0,0,43338,33560,33560,0,0,0,0,0,0,0,0,43338,0,0,0,0,33560,33560,0,0,0,33560,0,43338,33560,0,0,0,0,33560,33560,43338,0,0,33560,33560,43338,0,0,33560,0,0,0,0,0,0,0,0,0,43338,43338,43338,0,0,33560,43338,33560,0,33560,0,0,0,33560,0,0,0,0,33560,33560,0,0,33560,0,0,0,0,0,0,33560,33560,33560,0,0,0,0,0,33560,33560,33560,0,0,0,33560,0,0,33560,0,0,0,0,0,0,0,0,0,0,0,0,0,0,33560,33560,0,0,0,0,0,0,0,33560,33560,0,0,0,0,0,0,33560,33560,33560,0,0,33560,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,43338,33560,33560,33560,33560,0,0,0,33560,33560,33560,0,0,0,33560,33560,33560,0,0,0,0,43338,33560,0,0,0,0,33560,0,0,0,0,0,33560,43338,0,33560,0,0,0,33560,33560,33560,0,33560,33560,0,0,0,0,0,0,0,33560,33560,43338,0,0,33560,43338,43338,0,0,0,0,0,33560,33560,33560,0,0,0,33560,33560,0,0,0,33560,33560,33560,33560,0,33560,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,33560,33560,0,0,0,33560,33560,33560,0,43338,43338,33560,33560,33560,33560,0,0,0,0,33560,0,0,0,33560,0,0,0,0,0,0,0,0,0,33560,0,0,0,33560,33560,0,0,43338,33560,33560,43338,33560,0,0,33560,0,0,33560,0,33560,43338,33560,0,0,0,33560,33560,33560,0,0,33560,33560,0,0,0,0,0,0,0,0,33560,33560,33560,43338,0,0,0,0,0,33560,0,33560,33560,33560,0,0,33560,33560,0,33560,33560,33560,33560,33560,33560,0,0,0,0,0,0,0,33560,0,43338,0,0,0,33560,33560,43338,33560,33560,33560,0,0,0,0,33560,0,0,0,0,33560,33560,33560,33560,0,0,43338,33560,33560,0,0,0,0,0,0,0,0,0,33560,43338,43338,33560,33560,0,0,0,33560,33560,43338,0,0,0,0,43338,33560,33560,0,0,33560,33560,0,0,33560,33560,0,33560,0,0,33560,0,0,0,0,33560,33560,33560,0,33560,33560,0,33560,33560,33560,33560,33560,33560,33560,65535,0,33560,33560,33560,33560,0,33560,33560,33560,0,0,33560,0,43338,0,0,33560,33560,33560,33560,33560,33560,33560,33560,33560,0,0,33560,33560,33560,65535,65535,65535,33560,33560,33560,43338,0,43338,43338,0,33560,0,33560,33560,0,0,33560,33560,43338,33560,0,33560,43338,43338,0,0,0,33560,33560,33560,43338,65535,65535,65535,65535,65535,33560,33560,33560,0,0,33560,33560,0,33560,33560,0,43338,0,33560,33560,33560,33560,33560,43338,43338,43338,43338,43338,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,0,0,0,0,33560,33560,33560,33560,33560,33560,33560,0,0,43338,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,33560,0,33560,0,0,33560,43338,0,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,33560,0,33560,0,0,33560,43338,43338,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,33560,33560,33560,0,0,33560,43338,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,33560,33560,0,0,33560,43338,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,33560,0,0,33560,33560,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,33560,0,0,33560,33560,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,33560,0,33560,33560,33560,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,33560,33560,33560,33560,33560,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,65535,
};

const uint16_t road2[] =
{
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,24327,
};

const uint16_t fireball[] =
{
	0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6402,17920,0,17920,40194,6402,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24323,0,6402,24323,24323,24323,29188,57856,45825,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63512,40224,65049,48903,24327,65029,6168,40224,65049,7943,65286,24323,6402,10240,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6402,15649,15898,24331,7457,15897,56857,7946,15897,40224,24323,16135,24327,65286,63505,24832,0,49664,0,0,0,0,0,0,0,0,0,0,0,41984,16640,48153,32515,65286,48899,24323,15897,7457,15897,56857,40224,7457,24323,24323,24323,48899,64801,7457,24832,0,0,0,0,0,0,0,0,0,0,0,0,0,6402,64801,48666,24327,24327,40454,40224,48931,40224,24355,40224,16134,24327,16142,23841,15897,48899,65286,40224,6402,0,0,0,0,0,0,0,0,0,0,0,46616,40224,40224,40224,24090,24327,16135,40224,15897,48417,24327,24327,24327,16163,64803,64803,48931,24323,65050,40224,15897,6402,0,0,0,0,0,0,0,0,0,0,0,15649,65050,32291,65315,48906,24323,7457,7457,24090,40739,65315,23841,40224,32291,40709,40707,24323,16133,32275,64800,40224,18184,0,0,0,0,0,0,0,0,0,0,24327,55320,65315,48906,24323,16163,48902,32515,7947,65315,7957,16164,31500,57099,7940,32547,32515,40707,15649,16640,0,59144,0,0,0,0,0,0,0,16640,63512,7686,24327,7942,65282,18688,48420,32533,16135,40723,16163,48907,65293,40716,24331,24355,24327,65315,57124,65286,48666,56609,40224,7449,0,0,0,0,0,0,0,0,47621,64801,65049,15898,57098,7942,24327,24327,32515,15897,16163,48923,24323,7948,16142,40224,24327,7950,24327,16135,40224,24323,17920,18952,0,0,0,0,0,0,0,49664,7943,40225,48417,7457,56865,24323,57091,7457,24323,40224,16155,24323,57090,48673,57101,40224,32263,24327,16135,48899,40224,42497,0,0,0,0,0,0,0,0,0,6402,35329,24083,65286,24323,15649,23578,57094,16131,24323,24323,40715,24323,40224,7957,64801,40224,24326,6426,48647,7943,40224,0,0,0,0,0,0,0,0,0,0,24323,24323,40224,24327,2048,57098,15897,24323,57099,40707,24347,7939,16131,40224,23833,40224,65315,32519,65315,65057,48666,7457,0,0,0,0,0,0,0,0,0,0,17920,40194,7457,40710,57856,57102,40224,32515,57091,48922,40224,16142,57101,56609,48160,23833,7942,40740,64035,40224,40224,48906,0,0,0,0,0,0,0,0,0,0,6402,49664,48906,32033,32263,16134,40224,7943,7943,32548,40739,48932,24355,14868,56601,55840,48647,7972,65315,23841,15649,24323,0,0,0,0,0,0,0,0,0,0,24832,27393,40194,40224,24323,32519,23841,7947,24327,16135,16163,65315,16163,16142,40224,47129,15878,24327,65284,24323,24327,40194,0,0,0,0,0,0,0,0,0,0,0,0,0,50432,40224,40468,48147,64537,48899,24323,24323,65284,24327,16134,32518,16135,40474,48932,40707,32515,16135,17920,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64800,7457,19976,42240,48906,57090,63512,0,40224,56860,32519,48902,57124,16163,24323,65286,42497,0,0,0,0,0,0,0,0,0,0,0,0,0,0,49408,17920,64259,39941,15649,57090,7457,40224,40224,23328,0,23328,48900,24323,24323,65286,16135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17920,7683,16135,65286,38914,49664,6402,6402,0,63512,56601,57090,24323,24327,63512,40224,33792,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,34305,32007,24327,65286,24323,48417,7434,64800,40224,23834,40224,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,43009,24327,24327,24327,64787,48160,23328,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
};





int main()
{
	//Variables
	int hinverted = 0;
	int vinverted = 0;
	int toggle = 0;
	int hmoved = 0;
	int vmoved = 0;
	int	roadReset = 0;
	int i = 2;
	int lives = 3;
	int gameover = 0;
	int movement = 1;
	int var = 0;
	int image_var;
	int lane_choice;
	struct position pos;
	uint16_t x = 50;
	uint16_t y = 120;
	uint16_t oldx = x;
	uint16_t oldy = y;
	uint16_t car;
	uint16_t object;
	uint16_t explosion;
	uint16_t start = 0;
	initClock();
	initSysTick();
	setupIO();
	srand(time(NULL));


	while(1)
	{
		//Start screen
		while(start == 0)
		{	
			if(var == 0)
			{
				fillRectangle(0,0,SCREEN_WIDTH,SCREEN_HEIGHT,0);
				var++;
			}
			printTextX2("HOT WHEELS", 10,20, RGBToWord(0xff,0xff,0), 0);
			printText("PRESS DOWN TO", 20, 40, RGBToWord(0xff,0xff,0), 0);
			printText("START", 50, 60, RGBToWord(0xff,0xff,0), 0);
			if ( (GPIOA->IDR & (1 << 11)) == 0) // down pressed
			{	
				fillRectangle(0,0,128,160,0);
				start = 1;
				break;
			}
		}

		//Main code
		while (start == 1)
		{
			putImage(50,120,32,32,carTop,0,0);
			lives = 3;
			image_var = rand();

			while(1)
			{
				//Switches between different images of the road to create to image of a moving road	
				if(i % 20 == 0)
				{	fillRectangle(42,20,5,160,0);
					fillRectangle(86,20,5,160,0);
					putImage(42,20,4,160,road,0,0);
					putImage(86,20,4,160,road,0,0);
				}

				
				else
				{	fillRectangle(42,20,5,160,0);
					fillRectangle(86,20,5,160,0);
					putImage(42,20,4,160,road2,0,0);
					putImage(86,20,4,160,road2,0,0);
				}
				i++;

				pos = displayImage(pos);

				hmoved = vmoved = 0;
				hinverted = vinverted = 0;
				if ((GPIOB->IDR & (1 << 4))==0) // right pressed
				{					
					if (x < 90)
					{
						x = x + 4;
						hmoved = 1;
						hinverted=0;
					}						
				}
				if ((GPIOB->IDR & (1 << 5))==0) // left pressed
				{			
					
					if (x > 10)
					{
						x = x - 4;
						hmoved = 1;
						hinverted=1;
					}			
				}

			
				/*if ( (GPIOA->IDR & (1 << 11)) == 0) // down pressed
				{
					if (y < 140)
					{
						y = y + 4;			
						vmoved = 1;
						vinverted = 0;
					}
				}
				if ( (GPIOA->IDR & (1 << 8)) == 0) // up pressed
				{			
					if (y > 16)
					{
						y = y - 4;
						vmoved = 1;
						vinverted = 1;
					}
				}*/
			
				if ((vmoved) || (hmoved))
				{
					// only redraw if there has been some movement (reduces flicker)
					fillRectangle(oldx,oldy,32,32,0);
					oldx = x;
					oldy = y;					
					
					if (hmoved)
					{
						if (toggle)
							putImage(x,y,32,32,carTop,0,0);
						else
							putImage(x,y,32,32,carTop,0,0);
						
						toggle = toggle ^ 1;
					}
					
					else
					{
						putImage(x,y,32,32,carTop,0,vinverted);
					}
					
					
				}
				// Now check for an overlap by checking to see if ANY of the 4 corners of car are within the target area
				if (isInside(pos.objectX,pos.objectY,32,32,x,y) || isInside(pos.objectX,pos.objectY,32,32,x+32,y) || isInside(pos.objectX,pos.objectY,32,32,x,y+32) || isInside(pos.objectX,pos.objectY,32,32,x+32,y+32) )
				{
					putImage(x,y,32,32,fireball,0,0);
					lives - 1;
				}

				switch (lives)//switch statement for loss of lives
				{
					case 2:
						x = 50;
						pos.objectY = 0;
						break;

					case 1:
						x = 50;
						pos.objectY = 0;
						break;
				}
				

				delay(50);

				//Game over screen
				if(lives == 0)
				{
					start = 0;
					fillRectangle(50,pos.objectY,32,32,0);
					fillRectangle(0,pos.objectY,32,32,0);
					fillRectangle(x,y,32,32,0);
					pos.objectY = 20;
					x = 50;
					var = 0;
					break;
				}		
			}//end while(1)

		}//end while(start == 1)

	}//end while(1)

}//end main()

struct position displayImage(struct position pos)
{
	int i = 2;
	int x = rand() % 6;
	int y = 0;
	int leftLane = 0;
	int middleLane = 50;
	int rightLane = 94;

	/*if(i % 1 == 0)
	{
		fillRectangle(50,objectY,32,32,0);
		fillRectangle(0,objectY,32,32,0);
		fillRectangle(94,objectY,32,32,0);
		putImage(94,objectY,32,32,tree,0,0);
		putImage(50,objectY,32,32,tree,0,0);
		putImage(0,objectY,32,32,banana,0,0);
		objectY++;
	}*/
	if(pos.objectY == 160)
	{	
		pos.objectX2 = 0;
		pos.objectY = 0;
		switch(x){
			case 0:
				pos.objectX = leftLane;
				putImage(leftLane,pos.objectY,32,32,tree,0,0);
				break;
				
			case 1:
				pos.objectX = middleLane;
				putImage(middleLane,pos.objectY,32,32,tree,0,0);
				break;
			
			case 2:
				pos.objectX = rightLane;
				putImage(rightLane,pos.objectY,32,32,tree,0,0);
				break;

			case 3:
				pos.objectX = leftLane;
				pos.objectX2 = middleLane;
				putImage(leftLane,pos.objectY,32,32,tree,0,0);
				putImage(middleLane,pos.objectY,32,32,tree,0,0);
				break;
			
			case 4:
				pos.objectX = leftLane;
				pos.objectX2 = rightLane;
				putImage(leftLane,pos.objectY,32,32,tree,0,0);
				putImage(rightLane,pos.objectY,32,32,tree,0,0);
				break;

			case 5:
				pos.objectX = middleLane;
				pos.objectX2 = rightLane;
				putImage(middleLane,pos.objectY,32,32,tree,0,0);
				putImage(rightLane,pos.objectY,32,32,tree,0,0);
				break;
			
				}
	}
	else
	{
		pos.objectY++;
		fillRectangle(pos.objectX,pos.objectY,32,32,0);
		putImage(pos.objectX,pos.objectY,32,32,tree,0,0);

		if(pos.objectX2 > 0)
		{
			fillRectangle(pos.objectX2,pos.objectY,32,32,0);
			putImage(pos.objectX2,pos.objectY,32,32,tree,0,0);
		}
	}
	return pos;
}



void initSysTick(void)
{
	SysTick->LOAD = 48000;
	SysTick->CTRL = 7;
	SysTick->VAL = 10;
	__asm(" cpsie i "); // enable interrupts
}
void SysTick_Handler(void)
{
	milliseconds++;
}
void initClock(void)
{
// This is potentially a dangerous function as it could
// result in a system with an invalid clock signal - result: a stuck system
        // Set the PLL up
        // First ensure PLL is disabled
        RCC->CR &= ~(1u<<24);
        while( (RCC->CR & (1 <<25))); // wait for PLL ready to be cleared
        
// Warning here: if system clock is greater than 24MHz then wait-state(s) need to be
// inserted into Flash memory interface
				
        FLASH->ACR |= (1 << 0);
        FLASH->ACR &=~((1u << 2) | (1u<<1));
        // Turn on FLASH prefetch buffer
        FLASH->ACR |= (1 << 4);
        // set PLL multiplier to 12 (yielding 48MHz)
        RCC->CFGR &= ~((1u<<21) | (1u<<20) | (1u<<19) | (1u<<18));
        RCC->CFGR |= ((1<<21) | (1<<19) ); 

        // Need to limit ADC clock to below 14MHz so will change ADC prescaler to 4
        RCC->CFGR |= (1<<14);

        // and turn the PLL back on again
        RCC->CR |= (1<<24);        
        // set PLL as system clock source 
        RCC->CFGR |= (1<<1);
}
void delay(volatile uint32_t dly)
{
	uint32_t end_time = dly + milliseconds;
	while(milliseconds != end_time)
		__asm(" wfi "); // sleep
}

void enablePullUp(GPIO_TypeDef *Port, uint32_t BitNumber)
{
	Port->PUPDR = Port->PUPDR &~(3u << BitNumber*2); // clear pull-up resistor bits
	Port->PUPDR = Port->PUPDR | (1u << BitNumber*2); // set pull-up bit
}
void pinMode(GPIO_TypeDef *Port, uint32_t BitNumber, uint32_t Mode)
{
	/*
	*/
	uint32_t mode_value = Port->MODER;
	Mode = Mode << (2 * BitNumber);
	mode_value = mode_value & ~(3u << (BitNumber * 2));
	mode_value = mode_value | Mode;
	Port->MODER = mode_value;
}
int isInside(uint16_t x1, uint16_t y1, uint16_t w, uint16_t h, uint16_t px, uint16_t py)
{
	// checks to see if point px,py is within the rectange defined by x,y,w,h
	uint16_t x2,y2;
	x2 = x1+w;
	y2 = y1+h;
	int rvalue = 0;
	if ( (px >= x1) && (px <= x2))
	{
		// ok, x constraint met
		if ( (py >= y1) && (py <= y2))
			rvalue = 1;
	}
	return rvalue;
}

void setupIO()
{
	RCC->AHBENR |= (1 << 18) + (1 << 17); // enable Ports A and B
	display_begin();
	pinMode(GPIOB,4,0);
	pinMode(GPIOB,5,0);
	pinMode(GPIOA,8,0);
	pinMode(GPIOA,11,0);
	enablePullUp(GPIOB,4);
	enablePullUp(GPIOB,5);
	enablePullUp(GPIOA,11);
	enablePullUp(GPIOA,8);
}
